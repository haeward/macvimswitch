

好的，我来帮你添加自动更新 Homebrew tap 的 job。这个 job 会在发布完成后运行，创建一个 PR 来更新 Formula。

```yaml:.github/workflows/release.yml
# ... previous jobs remain the same ...

  update-homebrew:
    name: Update Homebrew Tap
    needs: [release]
    runs-on: ubuntu-latest
    steps:
      - name: Get version
        id: get_version
        run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

      - name: Download updated formula
        uses: actions/download-artifact@v4
        with:
          name: updated-formula
          path: ./

      - name: Checkout homebrew tap
        uses: actions/checkout@v4
        with:
          repository: jackiexiao/homebrew-tap  # 替换为你的 homebrew tap 仓库
          token: ${{ secrets.TAP_TOKEN }}      # 需要有写入权限的 token
          path: homebrew-tap

      - name: Update Formula
        run: |
          # 创建新分支
          cd homebrew-tap
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          
          branch_name="update-macvimswitch-${{ steps.get_version.outputs.VERSION }}"
          git checkout -b $branch_name
          
          # 复制更新后的 formula
          cp ../macvimswitch.rb Formula/
          
          # 提交更改
          git add Formula/macvimswitch.rb
          git commit -m "feat: update macvimswitch to ${{ steps.get_version.outputs.VERSION }}"
          git push origin $branch_name

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.TAP_TOKEN }}
          repository: jackiexiao/homebrew-tap  # 替换为你的 homebrew tap 仓库
          branch: update-macvimswitch-${{ steps.get_version.outputs.VERSION }}
          title: "feat: update macvimswitch to ${{ steps.get_version.outputs.VERSION }}"
          body: |
            Updates MacVimSwitch to version ${{ steps.get_version.outputs.VERSION }}
            
            - Updates version to ${{ steps.get_version.outputs.VERSION }}
            - Updates SHA256 hashes for both ARM64 and x86_64 builds
            
            This PR was automatically generated by GitHub Actions.
          base: main
          delete-branch: true
```

你需要进行以下设置：

1. 创建一个 Personal Access Token (PAT) 用于更新 Homebrew tap：
   - 访问 GitHub Settings -> Developer settings -> Personal access tokens
   - 创建一个具有 `repo` 权限的 token
   - 在你的仓库的 Settings -> Secrets -> Actions 中添加这个 token，命名为 `TAP_TOKEN`

2. 修改配置中的仓库名称：
   - 将 `jackiexiao/homebrew-tap` 替换为你的 Homebrew tap 仓库名称
   - 确保 tap 仓库中有 `Formula` 目录

3. 在你的 Homebrew tap 仓库中设置分支保护规则（可选但推荐）：
   - 保护 `main` 分支
   - 要求 PR 审查
   - 启用状态检查

完整的工作流程现在是：
1. 构建二进制文件
2. 计算 SHA256
3. 创建 GitHub Release
4. 更新 Formula 文件
5. 在 Homebrew tap 仓库中创建 PR

当你推送一个新的 tag 时，这个工作流程会：
- 构建并发布新版本
- 自动更新 Formula 中的版本号和 SHA256
- 创建一个 PR 来更新你的 Homebrew tap

你只需要审查并合并这个 PR，新版本就会在 Homebrew 中可用。

注意：确保在仓库的 Settings -> Actions -> General 中允许工作流程创建和批准 PR。